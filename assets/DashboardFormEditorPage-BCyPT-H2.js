import{j as e}from"./particles-CSzCUO-v.js";import{h as w,u as $,b as d}from"./vendor-BFu755QE.js";import{B as M,C as q,D as A}from"./services-BaVGtfnM.js";import{C as s}from"./index-BzGNHlk_.js";const I=()=>{const{formId:n}=w(),m=$(),i=!!(n&&n!=="new"),[R,g]=d.useState(i),[p,x]=d.useState(!1),[c,f]=d.useState(""),[h,b]=d.useState(""),[r,u]=d.useState([{question_text:"",question_order:1}]);d.useEffect(()=>{i&&n&&N()},[n,i]);const N=async()=>{if(n)try{const a=await M(n);f(a.form.title),b(a.form.description||""),u(a.questions.map(t=>({id:t.id,question_text:t.question_text,question_order:t.question_order})))}catch{alert("Gagal memuat formulir"),m("/dashboard/forms")}finally{g(!1)}},_=()=>{u([...r,{question_text:"",question_order:r.length+1}])},v=a=>{if(r.length===1){alert("Formulir harus memiliki minimal 1 pertanyaan");return}const t=r.filter((o,l)=>l!==a);t.forEach((o,l)=>{o.question_order=l+1}),u(t)},y=(a,t)=>{const o=[...r];o[a].question_text=t,u(o)},j=(a,t)=>{if(t==="up"&&a===0||t==="down"&&a===r.length-1)return;const o=[...r],l=t==="up"?a-1:a+1;[o[a],o[l]]=[o[l],o[a]],o.forEach((E,k)=>{E.question_order=k+1}),u(o)},T=async a=>{if(a.preventDefault(),!c.trim()){alert("Judul formulir harus diisi");return}if(r.some(t=>!t.question_text.trim())){alert("Semua pertanyaan harus diisi");return}x(!0);try{if(i&&n){const t={title:c.trim(),description:h.trim()||void 0,questions:r.map(o=>({id:o.id,question_text:o.question_text.trim(),question_order:o.question_order}))};await q(n,t)}else{const t={title:c.trim(),description:h.trim()||void 0,questions:r.map(o=>({question_text:o.question_text.trim(),question_order:o.question_order}))};await A(t)}m("/dashboard/forms")}catch(t){alert("Gagal menyimpan formulir"),console.error(t)}finally{x(!1)}};return R?e.jsx("div",{className:"flex justify-center items-center min-h-96",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-accent-blue mx-auto mb-4"}),e.jsx("p",{className:s.TEXT_SECONDARY,children:"Memuat formulir..."})]})}):e.jsxs("div",{children:[e.jsx("h1",{className:`text-2xl md:text-3xl font-bold ${s.TEXT_PRIMARY} mb-6`,children:i?"Edit Formulir":"Buat Formulir Baru"}),e.jsxs("form",{onSubmit:T,className:"space-y-6",children:[e.jsxs("div",{className:`${s.BG_SECONDARY} rounded-lg p-6 shadow-md`,children:[e.jsx("h2",{className:`text-xl font-bold ${s.TEXT_PRIMARY} mb-4`,children:"Informasi Formulir"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"title",className:`block ${s.TEXT_PRIMARY} mb-2 font-medium`,children:["Judul Formulir ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",id:"title",value:c,onChange:a=>f(a.target.value),placeholder:"Masukkan judul formulir",className:`w-full px-4 py-3 rounded-lg ${s.BG_PRIMARY} ${s.TEXT_PRIMARY} border ${s.BORDER} focus:outline-none focus:ring-2 focus:ring-accent-blue`,required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"description",className:`block ${s.TEXT_PRIMARY} mb-2 font-medium`,children:"Deskripsi (Opsional)"}),e.jsx("textarea",{id:"description",value:h,onChange:a=>b(a.target.value),placeholder:"Masukkan deskripsi formulir",rows:3,className:`w-full px-4 py-3 rounded-lg ${s.BG_PRIMARY} ${s.TEXT_PRIMARY} border ${s.BORDER} focus:outline-none focus:ring-2 focus:ring-accent-blue resize-none`})]})]})]}),e.jsxs("div",{className:`${s.BG_SECONDARY} rounded-lg p-6 shadow-md`,children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:`text-xl font-bold ${s.TEXT_PRIMARY}`,children:"Pertanyaan"}),e.jsx("button",{type:"button",onClick:_,className:`${s.BUTTON_PRIMARY} ${s.TEXT_ON_ACCENT} py-2 px-4 rounded-lg font-semibold hover:opacity-90 transition-opacity text-sm`,children:"+ Tambah Pertanyaan"})]}),e.jsx("div",{className:"space-y-4",children:r.map((a,t)=>e.jsx("div",{className:`${s.BG_PRIMARY} p-4 rounded-lg border ${s.BORDER}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsxs("div",{className:"flex flex-col gap-1 pt-3",children:[e.jsx("button",{type:"button",onClick:()=>j(t,"up"),disabled:t===0,className:"text-gray-400 hover:text-accent-blue disabled:opacity-30 disabled:cursor-not-allowed",title:"Pindah ke atas",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 15l7-7 7 7"})})}),e.jsx("button",{type:"button",onClick:()=>j(t,"down"),disabled:t===r.length-1,className:"text-gray-400 hover:text-accent-blue disabled:opacity-30 disabled:cursor-not-allowed",title:"Pindah ke bawah",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("label",{htmlFor:`question-${t}`,className:`block ${s.TEXT_PRIMARY} mb-2 font-medium`,children:["Pertanyaan ",t+1," ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("textarea",{id:`question-${t}`,value:a.question_text,onChange:o=>y(t,o.target.value),placeholder:"Masukkan pertanyaan",rows:3,className:`w-full px-4 py-3 rounded-lg ${s.BG_SECONDARY} ${s.TEXT_PRIMARY} border ${s.BORDER} focus:outline-none focus:ring-2 focus:ring-accent-blue resize-none`,required:!0})]}),e.jsx("button",{type:"button",onClick:()=>v(t),className:"text-red-500 hover:text-red-400 p-2 rounded-lg hover:bg-red-500/10 transition-colors mt-8",title:"Hapus pertanyaan",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})},t))})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("button",{type:"button",onClick:()=>m("/dashboard/forms"),className:`flex-1 ${s.BG_SECONDARY} ${s.TEXT_PRIMARY} border ${s.BORDER} py-3 px-6 rounded-lg font-semibold hover:opacity-90 transition-opacity`,children:"Batal"}),e.jsx("button",{type:"submit",disabled:p,className:`flex-1 ${s.BUTTON_PRIMARY} ${s.TEXT_ON_ACCENT} py-3 px-6 rounded-lg font-semibold hover:opacity-90 transition-opacity disabled:opacity-50 disabled:cursor-not-allowed`,children:p?"Menyimpan...":i?"Simpan Perubahan":"Buat Formulir"})]})]})]})};export{I as default};
