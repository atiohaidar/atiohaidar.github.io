import{j as e}from"./particles-CSzCUO-v.js";import{b as n,L as P}from"./vendor-BFu755QE.js";import{c as E,D as G}from"./index-BzGNHlk_.js";import{H as m,G as L}from"./services-BaVGtfnM.js";const I=()=>{const{theme:N}=E(),a=G[N],[h,y]=n.useState([]),[j,v]=n.useState([]),[$,b]=n.useState(!0),[g,f]=n.useState(null),[k,x]=n.useState(!1),[S,u]=n.useState(!1),[o,p]=n.useState(null),[l,d]=n.useState({item_id:"",quantity:1,start_date:"",end_date:"",notes:""}),[r,i]=n.useState({status:"approved",notes:""});n.useEffect(()=>{c()},[]);const c=async()=>{try{b(!0),f(null);const[t,s]=await Promise.all([m.list(),L.list()]);y(t),v(s)}catch(t){f(t.message||"Gagal memuat data")}finally{b(!1)}},w=async t=>{t.preventDefault();try{await m.create(l),x(!1),d({item_id:"",quantity:1,start_date:"",end_date:"",notes:""}),c()}catch(s){alert(s.message||"Gagal membuat peminjaman")}},D=async t=>{if(t.preventDefault(),!!o)try{await m.updateStatus(o.id,r),u(!1),p(null),i({status:"approved",notes:""}),c()}catch(s){alert(s.message||"Gagal memperbarui status")}},_=async t=>{if(confirm("Apakah Anda yakin ingin membatalkan peminjaman ini?"))try{await m.cancel(t),c()}catch(s){alert(s.message||"Gagal membatalkan peminjaman")}},B=t=>{p(t),i({status:t.status,notes:t.notes||""}),u(!0)},C=t=>({pending:"bg-yellow-500 text-white",approved:"bg-green-500 text-white",rejected:"bg-red-500 text-white",returned:"bg-blue-500 text-white",damaged:"bg-orange-500 text-white",extended:"bg-purple-500 text-white"})[t]||"bg-gray-500 text-white",M=t=>({pending:"Menunggu",approved:"Disetujui",rejected:"Ditolak",returned:"Dikembalikan",damaged:"Rusak",extended:"Diperpanjang"})[t]||t,q=t=>{const s=j.find(A=>A.id===t);return(s==null?void 0:s.name)||t};return e.jsxs("div",{children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between mb-6",children:[e.jsxs("div",{className:"mb-4 md:mb-0",children:[e.jsx("h2",{className:`text-xl font-semibold mb-2 ${a.panel.text}`,children:"Peminjaman Barang"}),e.jsx("p",{className:`text-sm ${a.panel.textMuted}`,children:"Kelola peminjaman barang"})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{onClick:()=>x(!0),className:`px-4 py-2 text-sm font-medium rounded-lg transition-colors ${a.buttons.info}`,children:"+ Pinjam Barang"}),e.jsx(P,{to:"/dashboard/items",className:`px-4 py-2 text-sm font-medium rounded-lg transition-colors ${a.buttons.primary}`,children:"Lihat Barang"})]})]}),e.jsx("div",{className:`${a.panel.bg} ${a.panel.border} rounded-lg p-6`,children:$?e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:a.panel.textMuted,children:"Memuat..."})}):g?e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-red-500",children:g})}):h.length===0?e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:a.panel.textMuted,children:"Belum ada peminjaman"})}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:`border-b ${a.panel.border}`,children:[e.jsx("th",{className:`text-left py-3 px-4 ${a.panel.text}`,children:"Barang"}),e.jsx("th",{className:`text-left py-3 px-4 ${a.panel.text}`,children:"Peminjam"}),e.jsx("th",{className:`text-left py-3 px-4 ${a.panel.text}`,children:"Jumlah"}),e.jsx("th",{className:`text-left py-3 px-4 ${a.panel.text}`,children:"Tanggal"}),e.jsx("th",{className:`text-left py-3 px-4 ${a.panel.text}`,children:"Status"}),e.jsx("th",{className:`text-left py-3 px-4 ${a.panel.text}`,children:"Aksi"})]})}),e.jsx("tbody",{children:h.map(t=>e.jsxs("tr",{className:`border-b ${a.panel.border}`,children:[e.jsx("td",{className:`py-3 px-4 ${a.panel.text}`,children:q(t.item_id)}),e.jsx("td",{className:`py-3 px-4 ${a.panel.textMuted}`,children:t.borrower_username}),e.jsx("td",{className:`py-3 px-4 ${a.panel.text}`,children:t.quantity}),e.jsx("td",{className:`py-3 px-4 ${a.panel.textMuted}`,children:e.jsxs("div",{className:"text-sm",children:[t.start_date," - ",t.end_date]})}),e.jsx("td",{className:"py-3 px-4",children:e.jsx("span",{className:`px-2 py-1 text-xs rounded ${C(t.status)}`,children:M(t.status)})}),e.jsx("td",{className:"py-3 px-4",children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>B(t),className:`px-3 py-1 text-xs rounded ${a.buttons.info}`,children:"Update"}),t.status==="pending"&&e.jsx("button",{onClick:()=>_(t.id),className:"px-3 py-1 text-xs rounded bg-red-500 text-white hover:bg-red-600",children:"Batal"})]})})]},t.id))})]})})}),k&&e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50",children:e.jsxs("div",{className:`${a.panel.bg} rounded-lg p-6 max-w-md w-full mx-4`,children:[e.jsx("h3",{className:`text-lg font-semibold mb-4 ${a.panel.text}`,children:"Pinjam Barang"}),e.jsxs("form",{onSubmit:w,children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:`block text-sm font-medium mb-2 ${a.panel.text}`,children:"Barang *"}),e.jsxs("select",{value:l.item_id,onChange:t=>d({...l,item_id:t.target.value}),className:`w-full px-3 py-2 border rounded-lg ${a.input}`,required:!0,children:[e.jsx("option",{value:"",children:"Pilih Barang"}),j.map(t=>e.jsxs("option",{value:t.id,children:[t.name," (Stok: ",t.stock,")"]},t.id))]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:`block text-sm font-medium mb-2 ${a.panel.text}`,children:"Jumlah *"}),e.jsx("input",{type:"number",min:"1",value:l.quantity,onChange:t=>d({...l,quantity:parseInt(t.target.value,10)}),className:`w-full px-3 py-2 border rounded-lg ${a.input}`,required:!0})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:`block text-sm font-medium mb-2 ${a.panel.text}`,children:"Tanggal Mulai *"}),e.jsx("input",{type:"date",value:l.start_date,onChange:t=>d({...l,start_date:t.target.value}),className:`w-full px-3 py-2 border rounded-lg ${a.input}`,required:!0})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:`block text-sm font-medium mb-2 ${a.panel.text}`,children:"Tanggal Selesai *"}),e.jsx("input",{type:"date",value:l.end_date,onChange:t=>d({...l,end_date:t.target.value}),className:`w-full px-3 py-2 border rounded-lg ${a.input}`,required:!0})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:`block text-sm font-medium mb-2 ${a.panel.text}`,children:"Catatan"}),e.jsx("textarea",{value:l.notes,onChange:t=>d({...l,notes:t.target.value}),className:`w-full px-3 py-2 border rounded-lg ${a.input}`,rows:3})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx("button",{type:"button",onClick:()=>{x(!1),d({item_id:"",quantity:1,start_date:"",end_date:"",notes:""})},className:`px-4 py-2 text-sm rounded-lg ${a.buttons.secondary}`,children:"Batal"}),e.jsx("button",{type:"submit",className:`px-4 py-2 text-sm rounded-lg ${a.buttons.primary}`,children:"Ajukan"})]})]})]})}),S&&o&&e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50",children:e.jsxs("div",{className:`${a.panel.bg} rounded-lg p-6 max-w-md w-full mx-4`,children:[e.jsx("h3",{className:`text-lg font-semibold mb-4 ${a.panel.text}`,children:"Update Status Peminjaman"}),e.jsxs("form",{onSubmit:D,children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:`block text-sm font-medium mb-2 ${a.panel.text}`,children:"Status *"}),e.jsxs("select",{value:r.status,onChange:t=>i({...r,status:t.target.value}),className:`w-full px-3 py-2 border rounded-lg ${a.input}`,required:!0,children:[e.jsx("option",{value:"pending",children:"Menunggu"}),e.jsx("option",{value:"approved",children:"Disetujui"}),e.jsx("option",{value:"rejected",children:"Ditolak"}),e.jsx("option",{value:"returned",children:"Dikembalikan"}),e.jsx("option",{value:"damaged",children:"Rusak"}),e.jsx("option",{value:"extended",children:"Diperpanjang"})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:`block text-sm font-medium mb-2 ${a.panel.text}`,children:"Catatan"}),e.jsx("textarea",{value:r.notes,onChange:t=>i({...r,notes:t.target.value}),className:`w-full px-3 py-2 border rounded-lg ${a.input}`,rows:3})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx("button",{type:"button",onClick:()=>{u(!1),p(null),i({status:"approved",notes:""})},className:`px-4 py-2 text-sm rounded-lg ${a.buttons.secondary}`,children:"Batal"}),e.jsx("button",{type:"submit",className:`px-4 py-2 text-sm rounded-lg ${a.buttons.primary}`,children:"Simpan"})]})]})]})})]})};export{I as default};
