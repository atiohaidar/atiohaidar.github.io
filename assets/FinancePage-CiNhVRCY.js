import{j as e}from"./particles-CSzCUO-v.js";import{b as f}from"./vendor-BFu755QE.js";import{u as P}from"./useAuth-D526BSg0.js";import{s as x,r as H,a as I,f as X,l as q,m as G,b as D,c as _,g as O,e as M,d as Y,h as J}from"./d3-C953wjub.js";import{c as K,D as Q}from"./index-BzGNHlk_.js";const ne=()=>{const{user:T,token:v}=P(),{theme:c}=K(),t=Q[c],[y,R]=f.useState([]),[C,A]=f.useState(!0),[$,L]=f.useState({totalVolume:0,totalTopUp:0,totalTransfer:0}),[n,U]=f.useState({startDate:"",endDate:"",type:"all",from_username:"",to_username:"",minAmount:"",maxAmount:""}),B=async()=>{A(!0);try{const a=new URLSearchParams;n.startDate&&a.append("startDate",n.startDate),n.endDate&&a.append("endDate",n.endDate),n.type!=="all"&&a.append("type",n.type),n.from_username&&a.append("from_username",n.from_username),n.to_username&&a.append("to_username",n.to_username),n.minAmount&&a.append("minAmount",n.minAmount),n.maxAmount&&a.append("maxAmount",n.maxAmount);const r=await(await fetch(`https://backend.atiohaidar.workers.dev/api/transactions?${a.toString()}`,{headers:{Authorization:`Bearer ${v}`}})).json();r.success&&r.transactions&&(R(r.transactions),F(r.transactions))}catch(a){console.error("Failed to fetch transactions",a)}finally{A(!1)}};f.useEffect(()=>{if(!v)return;const a=setTimeout(()=>{B()},500);return()=>clearTimeout(a)},[n,v]),f.useEffect(()=>{E(y)},[y,c]);const p=a=>{const{name:m,value:r}=a.target;U(g=>({...g,[m]:r}))},F=a=>{const m=a.reduce((l,u)=>l+u.amount,0),r=a.filter(l=>l.type==="topup").reduce((l,u)=>l+u.amount,0),g=a.filter(l=>l.type==="transfer").reduce((l,u)=>l+u.amount,0);L({totalVolume:m,totalTopUp:r,totalTransfer:g})},E=a=>{x("#chart-container").selectAll("*").remove();const m=c==="dark"?"#94a3b8":"#64748B",r=c==="dark"?"#334155":"#E2E8F0",g=c==="dark"?"bg-slate-800":"bg-white",l=c==="dark"?"text-white":"text-slate-800";if(a.length===0){x("#chart-container").append("div").attr("class",`p-4 ${t.panel.textMuted}`).text("No data to display");return}const u=H(a,s=>J(s,o=>o.amount),s=>{var o;return((o=s.created_at)==null?void 0:o.split(" ")[0])||"Unknown"}),b=Array.from(u,([s,o])=>({date:new Date(s),volume:o})).sort((s,o)=>s.date.getTime()-o.date.getTime()),d={top:20,right:30,bottom:30,left:60},k=800-d.left-d.right,h=400-d.top-d.bottom,i=x("#chart-container").append("svg").attr("width",k+d.left+d.right).attr("height",h+d.top+d.bottom).append("g").attr("transform",`translate(${d.left},${d.top})`),j=I().domain(X(b,s=>s.date)).range([0,k]),N=q().domain([0,G(b,s=>s.volume)]).nice().range([h,0]);i.append("g").attr("class","grid").attr("transform",`translate(0,${h})`).call(D(j).ticks(5).tickSize(-h).tickFormat(()=>"")).selectAll(".tick line").attr("stroke",r).attr("stroke-opacity",.5),i.append("g").attr("class","grid").call(_(N).ticks(5).tickSize(-k).tickFormat(()=>"")).selectAll(".tick line").attr("stroke",r).attr("stroke-opacity",.5),i.append("g").attr("transform",`translate(0,${h})`).call(D(j).ticks(5)).attr("color",m),i.append("g").call(_(N).ticks(5)).attr("color",m);const V=O().x(s=>j(s.date)).y0(h).y1(s=>N(s.volume)).curve(M);i.append("path").datum(b).attr("fill","url(#gradient)").attr("d",V);const z=Y().x(s=>j(s.date)).y(s=>N(s.volume)).curve(M);i.append("path").datum(b).attr("fill","none").attr("stroke","#10B981").attr("stroke-width",2).attr("d",z);const S=i.append("defs").append("linearGradient").attr("id","gradient").attr("x1","0%").attr("y1","0%").attr("x2","0%").attr("y2","100%");S.append("stop").attr("offset","0%").attr("stop-color","#10B981").attr("stop-opacity",.5),S.append("stop").attr("offset","100%").attr("stop-color","#10B981").attr("stop-opacity",0),x("body").selectAll(".finance-tooltip").remove();const w=x("body").append("div").attr("class",`finance-tooltip absolute z-50 ${g} ${l} text-xs p-2 rounded shadow-lg pointer-events-none opacity-0 transition-opacity border ${c==="dark"?"border-slate-700":"border-slate-200"}`);i.selectAll(".dot").data(b).enter().append("circle").attr("r",4).attr("cx",s=>j(s.date)).attr("cy",s=>N(s.volume)).attr("fill","#10B981").attr("stroke",c==="dark"?"#020617":"#ffffff").attr("stroke-width",2).on("mouseover",(s,o)=>{w.transition().duration(200).style("opacity",.9),w.html(`Date: ${o.date.toLocaleDateString()}<br/>Vol: Rp ${o.volume.toLocaleString()}`).style("left",s.pageX+10+"px").style("top",s.pageY-28+"px"),x(s.currentTarget).attr("r",6).attr("fill","#34d399")}).on("mouseout",s=>{w.transition().duration(500).style("opacity",0),x(s.currentTarget).attr("r",4).attr("fill","#10B981")})};return!T||T.role!=="admin"?e.jsx("div",{className:"p-8 text-center text-red-500",children:"Access Restricted"}):e.jsxs("div",{className:`min-h-screen ${t.appBg} ${t.panel.text} p-8`,children:[e.jsx("h1",{className:"text-3xl font-bold mb-8 text-transparent bg-clip-text bg-gradient-to-r from-emerald-400 to-teal-500",children:"Admin Finance Dashboard"}),e.jsxs("div",{className:`${t.panel.bg} p-6 rounded-2xl ${t.panel.border} backdrop-blur-sm mb-8 shadow-sm`,children:[e.jsx("h3",{className:`text-sm font-semibold ${t.panel.textMuted} mb-4 uppercase tracking-wider`,children:"Filters"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 lg:grid-cols-7 gap-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:`block text-xs ${t.panel.textMuted} mb-1`,children:"Date Range"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"date",name:"startDate",value:n.startDate,onChange:p,className:`w-full ${t.input} rounded px-3 py-2 text-sm focus:outline-none`}),e.jsx("input",{type:"date",name:"endDate",value:n.endDate,onChange:p,className:`w-full ${t.input} rounded px-3 py-2 text-sm focus:outline-none`})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:`block text-xs ${t.panel.textMuted} mb-1`,children:"Type"}),e.jsxs("select",{name:"type",value:n.type,onChange:p,className:`w-full ${t.input} rounded px-3 py-2 text-sm focus:outline-none`,children:[e.jsx("option",{value:"all",children:"All Types"}),e.jsx("option",{value:"transfer",children:"Transfer"}),e.jsx("option",{value:"topup",children:"Top Up"})]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:`block text-xs ${t.panel.textMuted} mb-1`,children:"Users"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",name:"from_username",placeholder:"Sender Username",value:n.from_username,onChange:p,className:`w-full ${t.input} rounded px-3 py-2 text-sm focus:outline-none`}),e.jsx("input",{type:"text",name:"to_username",placeholder:"Receiver Username",value:n.to_username,onChange:p,className:`w-full ${t.input} rounded px-3 py-2 text-sm focus:outline-none`})]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:`block text-xs ${t.panel.textMuted} mb-1`,children:"Amount Range"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"number",name:"minAmount",placeholder:"Min",value:n.minAmount,onChange:p,className:`w-full ${t.input} rounded px-3 py-2 text-sm focus:outline-none`}),e.jsx("input",{type:"number",name:"maxAmount",placeholder:"Max",value:n.maxAmount,onChange:p,className:`w-full ${t.input} rounded px-3 py-2 text-sm focus:outline-none`})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[e.jsxs("div",{className:`${t.panel.bg} p-6 rounded-2xl ${t.panel.border} backdrop-blur-sm shadow-sm`,children:[e.jsx("h3",{className:`${t.panel.textMuted} text-sm font-medium mb-2`,children:"Total Transaction Volume"}),e.jsxs("p",{className:`text-3xl font-bold ${t.panel.text}`,children:["Rp ",$.totalVolume.toLocaleString()]})]}),e.jsxs("div",{className:`${t.panel.bg} p-6 rounded-2xl ${t.panel.border} backdrop-blur-sm shadow-sm`,children:[e.jsx("h3",{className:`${t.panel.textMuted} text-sm font-medium mb-2`,children:"Total Top Ups"}),e.jsxs("p",{className:"text-3xl font-bold text-emerald-400",children:["+ Rp ",$.totalTopUp.toLocaleString()]})]}),e.jsxs("div",{className:`${t.panel.bg} p-6 rounded-2xl ${t.panel.border} backdrop-blur-sm shadow-sm`,children:[e.jsx("h3",{className:`${t.panel.textMuted} text-sm font-medium mb-2`,children:"Total Transfers"}),e.jsxs("p",{className:"text-3xl font-bold text-blue-400",children:["â†” Rp ",$.totalTransfer.toLocaleString()]})]})]}),e.jsxs("div",{className:`${t.panel.bg} p-6 rounded-2xl ${t.panel.border} backdrop-blur-sm mb-8 shadow-sm`,children:[e.jsx("h3",{className:`text-xl font-bold mb-6 ${t.panel.text}`,children:"Transaction Volume Trend"}),e.jsx("div",{id:"chart-container",className:"overflow-x-auto flex justify-center"})]}),e.jsxs("div",{className:`${t.panel.bg} rounded-2xl ${t.panel.border} overflow-hidden shadow-sm`,children:[e.jsx("div",{className:`p-6 border-b ${t.panel.divider} sticky top-0 ${t.panel.bg} z-10`,children:e.jsx("h3",{className:`text-xl font-bold ${t.panel.text}`,children:"Recent Transactions"})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left border-collapse",children:[e.jsx("thead",{className:`${c==="dark"?"bg-slate-800/50":"bg-gray-100/50"} ${t.panel.textMuted} text-xs uppercase tracking-wider`,children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-4 font-medium",children:"ID"}),e.jsx("th",{className:"p-4 font-medium",children:"Date"}),e.jsx("th",{className:"p-4 font-medium",children:"Type"}),e.jsx("th",{className:"p-4 font-medium",children:"Sender"}),e.jsx("th",{className:"p-4 font-medium",children:"Receiver"}),e.jsx("th",{className:"p-4 font-medium text-right",children:"Amount"}),e.jsx("th",{className:"p-4 font-medium",children:"Status"})]})}),e.jsx("tbody",{className:`divide-y ${t.panel.divider} text-sm ${t.panel.text}`,children:C?e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"p-8 text-center",children:"Loading transactions..."})}):y.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:`p-8 text-center ${t.panel.textMuted}`,children:"No transactions found"})}):y.map(a=>e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-white/5 transition-colors",children:[e.jsxs("td",{className:`p-4 ${t.panel.textMuted}`,children:["#",a.id]}),e.jsx("td",{className:"p-4 whitespace-nowrap",children:new Date(a.created_at).toLocaleString()}),e.jsx("td",{className:"p-4",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${a.type==="topup"?"bg-emerald-500/10 text-emerald-400 border border-emerald-500/20":"bg-blue-500/10 text-blue-400 border border-blue-500/20"}`,children:a.type==="topup"?"Top Up":"Transfer"})}),e.jsx("td",{className:"p-4",children:a.from_username||"-"}),e.jsx("td",{className:"p-4",children:a.to_username}),e.jsxs("td",{className:`p-4 text-right font-medium ${t.panel.text}`,children:["Rp ",a.amount.toLocaleString()]}),e.jsx("td",{className:"p-4",children:e.jsxs("span",{className:"text-emerald-400 flex items-center gap-1",children:[e.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-emerald-400"})," Success"]})})]},a.id))})]})})]})]})};export{ne as default};
