import{j as e}from"./particles-CSzCUO-v.js";import{b as c,h as ee,u as xe,L as I}from"./vendor-BFu755QE.js";import{r as ge}from"./roomService-DyUIZVgF.js";import{b as Z}from"./bookingService-Cehkg5m9.js";import{c as te,D as se,a as pe}from"./index-BzGNHlk_.js";const ae=c.memo(({room:a,className:f=""})=>e.jsxs("div",{className:`bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 ${f}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:a.name}),e.jsxs("p",{className:"text-gray-500 dark:text-gray-400 text-sm mt-1",children:["ID: ",a.id]})]}),e.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-medium ${a.available?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200":"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200"}`,children:a.available?"Tersedia":"Tidak Tersedia"})]}),e.jsx("div",{className:"grid grid-cols-2 gap-4 mb-4",children:e.jsxs("div",{className:"flex items-center gap-2 text-gray-600 dark:text-gray-300",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"})}),e.jsxs("span",{children:["Kapasitas: ",e.jsx("strong",{children:a.capacity})," orang"]})]})}),a.description&&e.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500 dark:text-gray-400 mb-2",children:"Deskripsi"}),e.jsx("p",{className:"text-gray-700 dark:text-gray-300",children:a.description})]})]}));ae.displayName="RoomInfoCard";const he={pending:{label:"Menunggu",bgColor:"bg-yellow-100 dark:bg-yellow-900",textColor:"text-yellow-800 dark:text-yellow-200",dotColor:"bg-yellow-500"},confirmed:{label:"Dikonfirmasi",bgColor:"bg-green-100 dark:bg-green-900",textColor:"text-green-800 dark:text-green-200",dotColor:"bg-green-500"},cancelled:{label:"Dibatalkan",bgColor:"bg-red-100 dark:bg-red-900",textColor:"text-red-800 dark:text-red-200",dotColor:"bg-red-500"}},be=c.memo(({booking:a,onViewDetail:f,onApprove:N,onReject:m,isAdmin:T=!1,className:B=""})=>{const o=he[a.status],S=j=>new Date(j).toLocaleTimeString("id-ID",{hour:"2-digit",minute:"2-digit"}),b=j=>new Date(j).toLocaleDateString("id-ID",{weekday:"short",day:"numeric",month:"short"});return e.jsxs("div",{className:`bg-white dark:bg-gray-800 rounded-lg shadow-md p-4 border-l-4 ${a.status==="confirmed"?"border-green-500":a.status==="pending"?"border-yellow-500":"border-red-500"} ${B}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:a.purpose}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:["oleh ",a.booker_username]})]}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${o.bgColor} ${o.textColor}`,children:o.label})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600 dark:text-gray-300 mb-3",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsxs("span",{children:[b(a.start_time)," • ",S(a.start_time)," - ",S(a.end_time)]})]}),e.jsxs("div",{className:"flex items-center gap-2 pt-2 border-t border-gray-200 dark:border-gray-700",children:[f&&e.jsx("button",{onClick:()=>f(a),className:"text-sm text-purple-600 dark:text-purple-400 hover:underline",children:"Lihat Detail"}),T&&a.status==="pending"&&e.jsxs(e.Fragment,{children:[N&&e.jsx("button",{onClick:()=>N(a.id),className:"ml-auto text-sm px-3 py-1 bg-green-500 text-white rounded hover:bg-green-600 transition-colors",children:"Setujui"}),m&&e.jsx("button",{onClick:()=>m(a.id),className:"text-sm px-3 py-1 bg-red-500 text-white rounded hover:bg-red-600 transition-colors",children:"Tolak"})]})]})]})});be.displayName="BookingCard";const w=(...a)=>a.filter(Boolean).join(" "),fe=({bookings:a,selectedDate:f,onBookingClick:N,canEditBooking:m,getDisplayDates:T})=>{const{theme:B}=te(),o=se[B],S=Array.from({length:24},(d,g)=>g),b=T(),j=170,$=Math.max(b.length*j,480),M=64,L=(d,g)=>a.filter(u=>{const y=new Date(u.start_time),r=new Date(u.end_time);return y.toDateString()===d.toDateString()&&y.getHours()<=g&&r.getHours()>g}),E=(d,g)=>{const u=new Date(d.start_time),y=new Date(d.end_time),r=u.getHours()+u.getMinutes()/60,k=y.getHours()+y.getMinutes()/60;if(r<g||r>=g+1)return null;const p=(r-g)*M,_=Math.max((k-r)*M,16);return{top:`${p}px`,height:`${_}px`}},F=d=>{switch(d){case"approved":return"bg-green-500";case"pending":return"bg-yellow-500";case"rejected":return"bg-red-500";case"cancelled":return"bg-gray-500";default:return"bg-gray-500"}};return e.jsx("div",{className:w("rounded-lg overflow-hidden",o.timeline.border),children:e.jsx("div",{className:"max-h-[600px] overflow-auto",children:e.jsxs("div",{className:"min-w-[480px]",style:{minWidth:`${$}px`},children:[e.jsxs("div",{className:w("grid border-b",o.timeline.border),style:{gridTemplateColumns:`80px repeat(${b.length}, minmax(${j}px, 1fr))`},children:[e.jsx("div",{className:w("sticky left-0 z-20 p-3 text-xs font-medium border-r",o.timeline.headerText,o.timeline.hourBg,o.timeline.border),children:"Jam"}),b.map((d,g)=>e.jsxs("div",{className:w("p-3 text-center border-r",o.timeline.border,o.timeline.headerBg),children:[e.jsx("div",{className:w("text-xs font-medium",o.timeline.headerText),children:d.toLocaleDateString("id-ID",{weekday:"short"})}),e.jsx("div",{className:w("text-base font-semibold",d.toDateString()===new Date().toDateString()?"text-accent-blue":o.panel.textMuted),children:d.getDate()}),e.jsx("div",{className:w("text-xs",o.panel.textMuted),children:d.toLocaleDateString("id-ID",{month:"short"})})]},g))]}),e.jsx("div",{className:"relative",style:{gridTemplateColumns:`80px repeat(${b.length}, minmax(${j}px, 1fr))`},children:S.map(d=>e.jsxs("div",{className:w("grid border-b",o.timeline.border),style:{gridTemplateColumns:`80px repeat(${b.length}, minmax(${j}px, 1fr))`,height:"64px"},children:[e.jsxs("div",{className:w("sticky left-0 z-10 px-3 py-2 text-xs flex items-start border-r",o.timeline.hourBg,o.panel.textMuted,o.timeline.border),children:[d.toString().padStart(2,"0"),":00"]}),b.map((g,u)=>{const y=L(g,d);return e.jsx("div",{className:w("relative border-r",o.timeline.border,g.toDateString()===new Date().toDateString()?o.timeline.today:d%2===0?o.timeline.stripeEven:o.timeline.stripeOdd),children:y.map(r=>{const k=E(r,d);if(!k)return null;const p=new Date(r.start_time),_=new Date(r.end_time);return e.jsxs("div",{className:`absolute left-1 right-1 ${F(r.status)} rounded text-white text-xs p-1 overflow-hidden ${m(r)?"cursor-pointer":"cursor-default"} hover:z-10 transition-all hover:shadow-lg`,style:{...k,minHeight:"16px"},onClick:()=>N(r),title:`${r.title} - ${r.user_username}
${p.toLocaleTimeString("id-ID",{hour:"2-digit",minute:"2-digit"})} - ${_.toLocaleTimeString("id-ID",{hour:"2-digit",minute:"2-digit"})}`,children:[e.jsx("div",{className:"truncate font-medium",children:r.title}),parseFloat(k.height??"0")>=45&&e.jsx("div",{className:"truncate opacity-90 text-xs",children:r.user_username})]},r.id)})},u)})]},d))})]})})})},n=(...a)=>a.filter(Boolean).join(" "),je=({showActions:a=!0})=>{const{roomId:f}=ee(),N=xe();console.log("RoomDetail - roomId:",f);const[m,T]=c.useState(null),[B,o]=c.useState([]),[S,b]=c.useState(!0),[j,$]=c.useState(!1),[M,L]=c.useState(null),[E,F]=c.useState(null),[d,g]=c.useState(null),[u,y]=c.useState(new Date),[r,k]=c.useState("day"),[p,_]=c.useState(null),[h,P]=c.useState({room_id:"",title:"",description:"",start_time:"",end_time:""}),[q,C]=c.useState(null),[A,W]=c.useState(!1),[ne,J]=c.useState(!1),{theme:re}=te(),t=se[re],K=s=>{const l=r==="week"?7:1;y(i=>new Date(i.getTime()+(s==="next"?l:-l)*24*60*60*1e3))},ie=()=>{y(new Date)},U=s=>{const l=[],i=new Date(s),x=i.getDay(),D=i.getDate()-x;i.setDate(D);for(let v=0;v<7;v++){const H=new Date(i);H.setDate(i.getDate()+v),l.push(H)}return l},oe=s=>{const l=U(s),i=l[0],x=l[6],D=i.getMonth()===x.getMonth(),v=i.getFullYear()===x.getFullYear(),H=new Intl.DateTimeFormat("id-ID",{day:"numeric",month:"long",year:"numeric"}).format(i),O={day:"numeric"};D||(O.month="long"),v||(O.year="numeric");const ue=new Intl.DateTimeFormat("id-ID",O).format(x);return`${H} - ${ue}`},Y=()=>r==="week"?U(u):[u];c.useEffect(()=>{f&&le(f);const s=pe();F((s==null?void 0:s.role)||null),g((s==null?void 0:s.username)||null)},[f]),c.useEffect(()=>{m&&V()},[m,u,r]),c.useEffect(()=>{p?(P({room_id:p.room_id,title:p.title,description:p.description||"",start_time:Q(p.start_time),end_time:Q(p.end_time)}),C(null),J(!0)):J(!1)},[p]);const le=async s=>{try{b(!0);const l=await ge.getRoom(s);T(l),L(null)}catch(l){L("Ruangan tidak ditemukan"),console.error("Error fetching room:",l)}finally{b(!1)}},V=async()=>{if(m)try{$(!0);const l=(await Z.getBookings(m.id)).filter(i=>i.room_id===m.id);o(l)}catch(s){console.error("Error fetching bookings:",s)}finally{$(!1)}},de=(s,l)=>s?r==="week"?s.filter(i=>{const x=new Date(i.start_time);return Y().some(v=>x.toDateString()===v.toDateString())}).sort((i,x)=>new Date(i.start_time).getTime()-new Date(x.start_time).getTime()):s.filter(i=>new Date(i.start_time).toDateString()===l.toDateString()).sort((i,x)=>new Date(i.start_time).getTime()-new Date(x.start_time).getTime()):[],G=s=>!!(E==="admin"||d&&s.user_username===d),Q=s=>{const l=new Date(s);return new Date(l.getTime()-l.getTimezoneOffset()*6e4).toISOString().slice(0,16)},X=s=>new Date(s).toISOString(),z=()=>{_(null),W(!1),C(null)},ce=s=>{G(s)?_(s):N(`/dashboard/bookings/${s.id}`)},R=s=>{const{name:l,value:i}=s.target;P(x=>({...x,[l]:i}))},me=async s=>{var x,D;if(s.preventDefault(),!p)return;if(!h.title||!h.start_time||!h.end_time){C("Semua field wajib diisi");return}const l=new Date(h.start_time),i=new Date(h.end_time);if(l>=i){C("Waktu selesai harus setelah waktu mulai");return}W(!0),C(null);try{await Z.updateBooking(p.id,{room_id:h.room_id,title:h.title,description:h.description,start_time:X(h.start_time),end_time:X(h.end_time)}),await V(),z()}catch(v){C(((D=(x=v.response)==null?void 0:x.data)==null?void 0:D.message)||"Gagal memperbarui booking"),W(!1)}};return S?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-accent-blue"})}):M||!m?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-red-400 mb-4",children:M||"Ruangan tidak ditemukan"}),e.jsx(I,{to:"/dashboard/rooms",className:"inline-block px-4 py-2 bg-accent-blue text-white rounded hover:bg-blue-600 transition-colors",children:"Kembali ke Daftar Ruangan"})]}):e.jsx("div",{className:"max-w-4xl mx-auto",children:e.jsxs("div",{className:"mb-8",children:[e.jsx(I,{to:"/dashboard/rooms",className:n("text-accent-blue hover:text-accent-blue/80 transition-colors text-sm mb-4 inline-block"),children:"← Kembali ke Daftar Ruangan"}),e.jsxs("div",{className:n(t.panel.bg,t.panel.border,"rounded-lg p-8"),children:[e.jsx(ae,{room:m,className:"mb-8 shadow-none p-0 bg-transparent dark:bg-transparent"}),e.jsxs("div",{className:n("mt-8 pt-6","border-t",t.panel.divider),children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:n("text-xl font-semibold",t.panel.text),children:"Jadwal Penggunaan Ruangan"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>k("day"),className:n("px-3 py-1 text-sm rounded transition-colors",r==="day"?t.buttons.primary:t.buttons.secondary),children:"Hari"}),e.jsx("button",{onClick:()=>k("week"),className:n("px-3 py-1 text-sm rounded transition-colors",r==="week"?t.buttons.primary:t.buttons.secondary),children:"Minggu"})]}),e.jsx("button",{onClick:()=>K("prev"),className:n("px-3 py-1 text-sm rounded transition-colors",t.buttons.secondary),children:"←"}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:n("text-sm font-medium",t.panel.text),children:r==="week"?oe(u):new Intl.DateTimeFormat("id-ID",{weekday:"long",year:"numeric",month:"long",day:"numeric"}).format(u)}),r==="day"&&u.toDateString()===new Date().toDateString()&&e.jsx("div",{className:"text-xs text-accent-blue",children:"Hari Ini"})]}),e.jsx("button",{onClick:()=>K("next"),className:n("px-3 py-1 text-sm rounded transition-colors",t.buttons.secondary),children:"→"}),u.toDateString()!==new Date().toDateString()&&e.jsx("button",{onClick:ie,className:n("px-3 py-1 text-xs rounded transition-colors",t.buttons.primary),children:"Hari Ini"})]})]}),j?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-accent-blue"})}):e.jsx(fe,{bookings:de(B,u),selectedDate:u,onBookingClick:ce,canEditBooking:G,getDisplayDates:Y})]}),ne&&p&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm p-4",children:e.jsxs("div",{className:n("relative w-full max-w-2xl rounded-2xl shadow-2xl",t.panel.bg,t.panel.border.replace("border ","border-2 ")),children:[e.jsx("button",{onClick:z,className:n("absolute right-4 top-4 transition-colors",t.panel.textMuted,"hover:text-white"),"aria-label":"Tutup",children:"×"}),e.jsxs("div",{className:"p-6 md:p-8 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:n("text-2xl font-semibold mb-1",t.panel.text),children:"Edit Booking"}),e.jsx("p",{className:n("text-sm",t.panel.textMuted),children:"Perbarui informasi booking sesuai kebutuhan"})]}),q&&e.jsx("div",{className:"p-4 bg-red-500/10 border border-red-500/30 rounded-lg text-sm text-red-300",children:q}),e.jsxs("form",{onSubmit:me,className:"space-y-5",children:[e.jsxs("div",{children:[e.jsx("label",{className:n("block text-sm font-medium mb-2",t.panel.text),children:"Ruangan"}),e.jsx("input",{type:"text",value:(m==null?void 0:m.name)||p.room_id,disabled:!0,className:n("w-full px-4 py-3 rounded-lg cursor-not-allowed",t.panel.border,t.panel.bg,t.panel.textMuted)})]}),e.jsxs("div",{children:[e.jsx("label",{className:n("block text-sm font-medium mb-2",t.panel.text),children:"Judul Booking *"}),e.jsx("input",{type:"text",name:"title",value:h.title,onChange:R,required:!0,maxLength:100,className:n("w-full px-4 py-3 rounded-lg focus:outline-none focus:ring-2 focus:ring-accent-blue",t.panel.border,t.panel.bg,t.panel.text)})]}),e.jsxs("div",{children:[e.jsx("label",{className:n("block text-sm font-medium mb-2",t.panel.text),children:"Deskripsi"}),e.jsx("textarea",{name:"description",value:h.description,onChange:R,rows:3,maxLength:500,className:n("w-full px-4 py-3 rounded-lg focus:outline-none focus:ring-2 focus:ring-accent-blue resize-vertical",t.panel.border,t.panel.bg,t.panel.text)})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:n("block text-sm font-medium mb-2",t.panel.text),children:"Waktu Mulai *"}),e.jsx("input",{type:"datetime-local",name:"start_time",value:h.start_time,onChange:R,required:!0,className:n("w-full px-4 py-3 rounded-lg focus:outline-none focus:ring-2 focus:ring-accent-blue",t.panel.border,t.panel.bg,t.panel.text)})]}),e.jsxs("div",{children:[e.jsx("label",{className:n("block text-sm font-medium mb-2",t.panel.text),children:"Waktu Selesai *"}),e.jsx("input",{type:"datetime-local",name:"end_time",value:h.end_time,min:h.start_time,onChange:R,required:!0,className:n("w-full px-4 py-3 rounded-lg focus:outline-none focus:ring-2 focus:ring-accent-blue",t.panel.border,t.panel.bg,t.panel.text)})]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row md:justify-end md:items-center gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:z,className:n("w-full md:w-auto px-5 py-3 rounded-lg transition-colors",t.buttons.ghost),children:"Batal"}),e.jsx("button",{type:"submit",disabled:A,className:n("w-full md:w-auto px-6 py-3 rounded-lg disabled:opacity-60 disabled:cursor-not-allowed transition-colors",t.buttons.primary),children:A?"Menyimpan...":"Simpan Perubahan"})]})]})]})]})}),a&&e.jsx("div",{className:n("mt-8 pt-6 border-t",t.panel.divider),children:e.jsxs("div",{className:"flex flex-wrap gap-4",children:[m.available&&e.jsx(I,{to:`/dashboard/bookings/new?roomId=${m.id}`,className:n("px-6 py-3 rounded-lg transition-colors",t.buttons.primary),children:"Booking Ruangan"}),E==="admin"&&e.jsx(I,{to:`/dashboard/rooms/${m.id}/edit`,className:"px-6 py-3 bg-orange-500 text-white rounded-lg hover:bg-orange-600 transition-colors",children:"✏️ Edit Ruangan"}),e.jsx(I,{to:"/dashboard/rooms",className:n("px-6 py-3 rounded-lg transition-colors",t.buttons.ghost),children:"Lihat Ruangan Lain"})]})})]})]})})},Ne=()=>{const{roomId:a}=ee();return console.log("DashboardRoomDetailPage - roomId:",a),e.jsx("div",{children:e.jsx(je,{showActions:!0})})};export{Ne as default};
