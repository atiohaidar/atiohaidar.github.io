import{j as e}from"./particles-CSzCUO-v.js";import{u as Y,h as I,b as a}from"./vendor-BFu755QE.js";import{a as _,g as O,c as q}from"./apiClient-0gU9eKXL.js";import{N as H,S as u,b as J}from"./ScrollReveal-DVDuLnJK.js";import{u as G}from"./index-BzGNHlk_.js";import{u as K}from"./useParallax-C7KmvLtK.js";import{a as Q,d as V,b as X}from"./discussionService-Ok7SlrFG.js";import"./ThemeToggle-Cc29PLh4.js";import"./SpyTooltip-Bn4cKGvG.js";const ce=()=>{var R;const h=Y(),{discussionId:r}=I(),c=_(),{data:P}=G(),{profile:$}=P,p=K(),[z,y]=a.useState(null),[s,T]=a.useState(null),[U,j]=a.useState(!0),[w,i]=a.useState(null),[d,N]=a.useState(""),[x,g]=a.useState(""),[v,k]=a.useState(!1),[D,L]=a.useState(!1);a.useEffect(()=>{const t=O(),n=_();t&&n&&y(n.username)},[]),a.useEffect(()=>{r&&S()},[r]);const A=()=>{q(),y(null),h("/",{replace:!0})},S=async()=>{if(r){j(!0),i(null);try{const t=await Q(r);T(t)}catch(t){i(t.message||"Failed to load discussion")}finally{j(!1)}}},B=async()=>{if(!r||!d.trim()){i("Reply content is required");return}!c&&!x.trim()&&g("Anonymous"),k(!0),i(null);try{const t={content:d.trim()};!c&&x.trim()&&(t.creator_name=x.trim()),await X(r,t),N(""),g(""),await S()}catch(t){i(t.message||"Failed to post reply")}finally{k(!1)}},E=async()=>{if(!(!r||!s)&&confirm("Are you sure you want to delete this discussion? This action cannot be undone.")){L(!0),i(null);try{await V(r),h("/discussions")}catch(t){i(t.message||"Failed to delete discussion"),L(!1)}}},C=t=>{const n=new Date(t),l=new Date().getTime()-n.getTime(),o=Math.floor(l/6e4),f=Math.floor(l/36e5),b=Math.floor(l/864e5);return o<1?"Just now":o<60?`${o} minute${o>1?"s":""} ago`:f<24?`${f} hour${f>1?"s":""} ago`:b<7?`${b} day${b>1?"s":""} ago`:n.toLocaleDateString()},M=t=>{const n=/(https?:\/\/[^\s]+)/g;return t.split(n).map((l,o)=>l.match(n)?e.jsx("a",{href:l,target:"_blank",rel:"noopener noreferrer",className:"text-accent-blue hover:underline",children:l},o):e.jsx("span",{children:l},o))},F=s&&c&&(c.role==="admin"||s.creator_username&&s.creator_username===c.username),m=$||{logoSrc:"./PP-Tio.jpg",socials:{github:"https://github.com/atiohaidar",linkedin:"https://www.linkedin.com/in/atiohaidar/",instagram:"https://www.instagram.com/tiohaidarhanif"},copyright:"Sebuah website random"};return e.jsxs("div",{className:"relative min-h-screen bg-light-bg dark:bg-deep-navy transition-colors duration-300 overflow-hidden",children:[e.jsx("div",{className:"fixed inset-0 bg-gradient-to-br from-blue-500/5 via-cyan-500/5 to-purple-500/5 -z-10"}),e.jsx("div",{className:"fixed top-[20%] right-[10%] w-[600px] h-[600px] bg-accent-blue/40 rounded-full blur-[120px] animate-blob mix-blend-multiply dark:mix-blend-screen opacity-90 -z-10 pointer-events-none",style:{transform:`translateY(${p.getOffset(.05,"down")}px)`}}),e.jsx("div",{className:"fixed bottom-[20%] left-[10%] w-[600px] h-[600px] bg-purple-500/40 rounded-full blur-[120px] animate-blob animation-delay-2000 mix-blend-multiply dark:mix-blend-screen opacity-90 -z-10 pointer-events-none",style:{transform:`translateY(${p.getOffset(.08,"down")}px)`}}),e.jsx("div",{className:"fixed top-[40%] left-[40%] w-[600px] h-[600px] bg-cyan-500/40 rounded-full blur-[120px] animate-blob animation-delay-4000 mix-blend-multiply dark:mix-blend-screen opacity-90 -z-10 pointer-events-none",style:{transform:`translateY(${p.getOffset(.12,"down")}px)`}}),e.jsx(H,{logoSrc:m.logoSrc,socials:m.socials,loggedInUser:z,onLogout:A}),e.jsx("main",{className:"mx-auto relative z-10 pt-32 pb-16",children:e.jsxs("div",{className:"container mx-auto px-6 md:px-12 max-w-4xl",children:[e.jsx(u,{delay:100,children:e.jsxs("button",{onClick:()=>h("/discussions"),className:"mb-6 flex items-center gap-2 text-light-muted dark:text-slate-400 hover:text-accent-blue transition-colors",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 19l-7-7m0 0l7-7m-7 7h18"})}),"Back to Discussions"]})}),w&&e.jsx("div",{className:"glass-card border-red-500/30 px-4 py-3 rounded-xl mb-6 text-red-500 text-center",children:w}),U?e.jsxs("div",{className:"text-center py-16",children:[e.jsx("div",{className:"inline-block w-8 h-8 border-2 border-accent-blue/30 border-t-accent-blue rounded-full animate-spin mb-4"}),e.jsx("p",{className:"text-light-muted dark:text-soft-gray",children:"Loading discussion..."})]}):s?e.jsxs(e.Fragment,{children:[e.jsx(u,{delay:150,children:e.jsxs("div",{className:"glass-card rounded-2xl p-6 md:p-8 mb-6",children:[e.jsxs("div",{className:"flex justify-between items-start gap-4 mb-4",children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold text-light-text dark:text-white",children:s.title}),F&&e.jsx("button",{onClick:E,disabled:D,className:"text-red-500 hover:text-red-600 text-sm font-medium transition-colors disabled:opacity-50 whitespace-nowrap",children:D?"Deleting...":"Delete"})]}),e.jsxs("div",{className:"flex items-center gap-3 mb-6 text-sm text-light-muted dark:text-slate-400",children:[e.jsx("span",{className:"w-10 h-10 rounded-full bg-accent-blue/10 flex items-center justify-center text-accent-blue font-bold text-sm",children:s.creator_name.substring(0,2).toUpperCase()}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-light-text dark:text-white",children:s.creator_name}),s.is_anonymous&&e.jsx("span",{className:"ml-1 opacity-60",children:"(anonymous)"}),e.jsx("span",{className:"mx-2",children:"•"}),e.jsx("span",{children:C(s.created_at)})]})]}),e.jsx("div",{className:"text-light-text dark:text-soft-gray whitespace-pre-wrap leading-relaxed",children:M(s.content)})]})}),e.jsx(u,{delay:200,children:e.jsxs("div",{className:"glass-card rounded-2xl p-6 md:p-8 mb-6",children:[e.jsxs("h2",{className:"text-xl font-bold text-light-text dark:text-white mb-6 flex items-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5 text-accent-blue",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})}),"Replies (",((R=s.replies)==null?void 0:R.length)||0,")"]}),s.replies&&s.replies.length>0?e.jsx("div",{className:"space-y-4",children:s.replies.map((t,n)=>e.jsxs("div",{className:"border-l-2 border-accent-blue/30 pl-4 py-3 hover:border-accent-blue transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2 text-sm",children:[e.jsx("span",{className:"w-7 h-7 rounded-full bg-purple-500/10 flex items-center justify-center text-purple-500 font-bold text-xs",children:t.creator_name.substring(0,2).toUpperCase()}),e.jsx("span",{className:"font-medium text-light-text dark:text-white",children:t.creator_name}),t.is_anonymous&&e.jsx("span",{className:"text-light-muted dark:text-slate-500 text-xs",children:"(anonymous)"}),e.jsx("span",{className:"text-light-muted dark:text-slate-500",children:"•"}),e.jsx("span",{className:"text-light-muted dark:text-slate-500",children:C(t.created_at)})]}),e.jsx("div",{className:"text-light-text dark:text-soft-gray pl-9",children:M(t.content)})]},t.id))}):e.jsx("p",{className:"text-light-muted dark:text-slate-500 italic text-center py-4",children:"No replies yet. Be the first to reply!"})]})}),e.jsx(u,{delay:250,children:e.jsxs("div",{className:"glass-card rounded-2xl p-6 md:p-8",children:[e.jsxs("h2",{className:"text-xl font-bold text-light-text dark:text-white mb-6 flex items-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5 text-accent-blue",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6"})}),"Post a Reply"]}),!c&&e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-light-text dark:text-white mb-2",children:"Your Name (optional)"}),e.jsx("input",{type:"text",value:x,onChange:t=>g(t.target.value),placeholder:"Leave empty to post as Anonymous",className:"w-full px-4 py-3 rounded-xl border border-gray-200 dark:border-white/10 bg-white/50 dark:bg-white/5 text-light-text dark:text-white placeholder-light-muted dark:placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-accent-blue/50 transition-all"})]}),e.jsx("div",{className:"mb-4",children:e.jsx("textarea",{value:d,onChange:t=>N(t.target.value),placeholder:"Write your reply... (Links are allowed)",rows:4,className:"w-full px-4 py-3 rounded-xl border border-gray-200 dark:border-white/10 bg-white/50 dark:bg-white/5 text-light-text dark:text-white placeholder-light-muted dark:placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-accent-blue/50 transition-all resize-none"})}),e.jsx("button",{onClick:B,disabled:v||!d.trim(),className:"px-6 py-2.5 rounded-full text-sm font-medium bg-accent-blue text-white hover:bg-accent-blue/90 hover:shadow-lg hover:shadow-accent-blue/25 transition-all disabled:opacity-50",children:v?"Posting...":"Post Reply"})]})})]}):e.jsxs("div",{className:"glass-card rounded-2xl p-12 text-center",children:[e.jsx("div",{className:"text-5xl mb-4",children:"❌"}),e.jsx("h3",{className:"text-xl font-semibold text-light-text dark:text-white mb-2",children:"Discussion not found"}),e.jsx("p",{className:"text-light-muted dark:text-soft-gray",children:"The discussion you're looking for doesn't exist or has been deleted."})]})]})}),e.jsx(J,{socials:m.socials,copyright:m.copyright})]})};export{ce as default};
