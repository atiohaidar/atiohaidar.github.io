import{j as e}from"./particles-CSzCUO-v.js";import{h as Z,u as ee,b as r}from"./vendor-BFu755QE.js";import{L as C,M as se,N as te,n as ae,l as re,O as ne,P as ie,Q as le}from"./services-BaVGtfnM.js";import{C as s}from"./index-BzGNHlk_.js";import{a as oe}from"./apiClient-0gU9eKXL.js";const xe=()=>{const{ticketId:c}=Z(),M=ee(),[a,d]=r.useState(null),[u,b]=r.useState([]),[m,R]=r.useState([]),[w,S]=r.useState([]),[X,B]=r.useState([]),[O,f]=r.useState(!0),[T,j]=r.useState(null),[l,G]=r.useState(null),[g,y]=r.useState(""),[N,_]=r.useState(!1),[v,E]=r.useState(!1),[x,k]=r.useState(""),[$,A]=r.useState(""),[I,P]=r.useState(!1),[L,p]=r.useState(!1),[i,o]=r.useState({title:"",description:"",category_id:0,status:"",priority:""}),[Y,D]=r.useState(!1);r.useEffect(()=>{const t=oe();t&&G(t),K()},[c]);const K=async()=>{if(c){f(!0),j(null);try{const[t,n,h,V,W]=await Promise.all([C(Number(c)),se(Number(c),!0),te(Number(c)),ae(),re()]);d(t),b(n),R(h),S(V),B(W),o({title:t.title,description:t.description,category_id:t.category_id,status:t.status,priority:t.priority})}catch(t){j(t instanceof Error?t.message:"Failed to load ticket")}finally{f(!1)}}},U=async t=>{if(t.preventDefault(),!(!a||!g.trim())){E(!0);try{const n=await ie(a.id,{comment_text:g.trim(),is_internal:N});b([...u,n]),y(""),_(!1)}catch(n){alert(n instanceof Error?n.message:"Failed to add comment")}finally{E(!1)}}},F=async t=>{if(t.preventDefault(),!(!a||!x)){P(!0);try{const n=await le(a.id,{assigned_to:x,notes:$.trim()||void 0});R([n,...m]),k(""),A("");const h=await C(a.id);d(h)}catch(n){alert(n instanceof Error?n.message:"Failed to assign ticket")}finally{P(!1)}}},q=async t=>{if(t.preventDefault(),!!a){D(!0);try{const n=await ne(a.id,{...i,status:i.status,priority:i.priority});d(n),p(!1)}catch(n){alert(n instanceof Error?n.message:"Failed to update ticket")}finally{D(!1)}}},z=t=>{switch(t){case"open":return"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-100";case"in_progress":return"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-100";case"waiting":return"bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-100";case"solved":return"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-100";default:return"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-100"}},J=t=>{switch(t){case"open":return"Terbuka";case"in_progress":return"Dalam Proses";case"waiting":return"Menunggu";case"solved":return"Selesai";default:return t}},Q=t=>{switch(t){case"low":return"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-100";case"medium":return"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-100";case"high":return"bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-100";case"critical":return"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-100";default:return"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-100"}},H=t=>{switch(t){case"low":return"Rendah";case"medium":return"Sedang";case"high":return"Tinggi";case"critical":return"Kritis";default:return t}};return O?e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsx("div",{className:`text-center ${s.TEXT_PRIMARY}`,children:"Memuat tiket..."})}):T||!a?e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsx("div",{className:"text-center text-red-500",children:T||"Ticket not found"})}):e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:`text-3xl font-bold ${s.TEXT_PRIMARY}`,children:"Detail Tiket"}),e.jsx("button",{onClick:()=>M("/dashboard/tickets"),className:`px-4 py-2 rounded-lg ${s.BG_SECONDARY} ${s.TEXT_PRIMARY} hover:opacity-80 transition-opacity`,children:"â† Kembali"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsx("div",{className:`${s.BG_SECONDARY} rounded-lg p-6 border ${s.BORDER}`,children:L?e.jsxs("form",{onSubmit:q,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:`block ${s.TEXT_PRIMARY} mb-2 font-medium`,children:"Judul"}),e.jsx("input",{type:"text",value:i.title,onChange:t=>o({...i,title:t.target.value}),className:`w-full px-4 py-2 rounded-lg ${s.BG_PRIMARY} ${s.TEXT_PRIMARY} border ${s.BORDER} focus:outline-none focus:ring-2 focus:ring-accent-blue`,required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:`block ${s.TEXT_PRIMARY} mb-2 font-medium`,children:"Deskripsi"}),e.jsx("textarea",{value:i.description,onChange:t=>o({...i,description:t.target.value}),rows:6,className:`w-full px-4 py-2 rounded-lg ${s.BG_PRIMARY} ${s.TEXT_PRIMARY} border ${s.BORDER} focus:outline-none focus:ring-2 focus:ring-accent-blue resize-none`,required:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:`block ${s.TEXT_PRIMARY} mb-2 font-medium`,children:"Kategori"}),e.jsx("select",{value:i.category_id,onChange:t=>o({...i,category_id:Number(t.target.value)}),className:`w-full px-4 py-2 rounded-lg ${s.BG_PRIMARY} ${s.TEXT_PRIMARY} border ${s.BORDER} focus:outline-none focus:ring-2 focus:ring-accent-blue`,children:X.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:`block ${s.TEXT_PRIMARY} mb-2 font-medium`,children:"Status"}),e.jsxs("select",{value:i.status,onChange:t=>o({...i,status:t.target.value}),className:`w-full px-4 py-2 rounded-lg ${s.BG_PRIMARY} ${s.TEXT_PRIMARY} border ${s.BORDER} focus:outline-none focus:ring-2 focus:ring-accent-blue`,children:[e.jsx("option",{value:"open",children:"Terbuka"}),e.jsx("option",{value:"in_progress",children:"Dalam Proses"}),e.jsx("option",{value:"waiting",children:"Menunggu"}),e.jsx("option",{value:"solved",children:"Selesai"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:`block ${s.TEXT_PRIMARY} mb-2 font-medium`,children:"Prioritas"}),e.jsxs("select",{value:i.priority,onChange:t=>o({...i,priority:t.target.value}),className:`w-full px-4 py-2 rounded-lg ${s.BG_PRIMARY} ${s.TEXT_PRIMARY} border ${s.BORDER} focus:outline-none focus:ring-2 focus:ring-accent-blue`,children:[e.jsx("option",{value:"low",children:"Rendah"}),e.jsx("option",{value:"medium",children:"Sedang"}),e.jsx("option",{value:"high",children:"Tinggi"}),e.jsx("option",{value:"critical",children:"Kritis"})]})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("button",{type:"submit",disabled:Y,className:`flex-1 px-4 py-2 rounded-lg ${s.BUTTON_PRIMARY} ${s.TEXT_ON_ACCENT} hover:opacity-90 transition-opacity disabled:opacity-50`,children:Y?"Menyimpan...":"Simpan"}),e.jsx("button",{type:"button",onClick:()=>p(!1),className:`flex-1 px-4 py-2 rounded-lg ${s.BG_PRIMARY} ${s.TEXT_PRIMARY} border ${s.BORDER} hover:opacity-80`,children:"Batal"})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsx("h2",{className:`text-2xl font-bold ${s.TEXT_PRIMARY}`,children:a.title}),(l==null?void 0:l.role)==="admin"&&e.jsx("button",{onClick:()=>p(!0),className:`px-4 py-2 rounded-lg ${s.BUTTON_PRIMARY} ${s.TEXT_ON_ACCENT} text-sm hover:opacity-90`,children:"Edit"})]}),e.jsxs("div",{className:"flex gap-2 mb-4",children:[e.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-semibold ${z(a.status)}`,children:J(a.status)}),e.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-semibold ${Q(a.priority)}`,children:H(a.priority)})]}),e.jsxs("div",{className:`${s.TEXT_SECONDARY} space-y-2 mb-4`,children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Token:"})," ",e.jsx("code",{className:"font-mono",children:a.token})]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Kategori:"})," ",a.category_name]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Pelapor:"})," ",a.submitter_name||"Anonim"," ",a.submitter_email&&`(${a.submitter_email})`]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Ditangani oleh:"})," ",a.assigned_to||"Belum ditugaskan"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Dibuat:"})," ",new Date(a.created_at||"").toLocaleString("id-ID")]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Terakhir diperbarui:"})," ",new Date(a.updated_at||"").toLocaleString("id-ID")]})]}),e.jsxs("div",{className:`${s.TEXT_PRIMARY} whitespace-pre-wrap`,children:[e.jsx("strong",{children:"Deskripsi:"}),e.jsx("p",{className:"mt-2",children:a.description})]}),a.reference_link&&e.jsx("div",{className:"mt-4",children:e.jsx("a",{href:a.reference_link,target:"_blank",rel:"noopener noreferrer",className:`${s.TEXT_ACCENT} hover:underline`,children:"ðŸ”— Link Referensi"})})]})}),e.jsxs("div",{className:`${s.BG_SECONDARY} rounded-lg p-6 border ${s.BORDER}`,children:[e.jsx("h3",{className:`text-xl font-bold ${s.TEXT_PRIMARY} mb-4`,children:"Komentar"}),u.length===0?e.jsx("p",{className:`${s.TEXT_SECONDARY} text-center py-4`,children:"Belum ada komentar"}):e.jsx("div",{className:"space-y-4 mb-6",children:u.map(t=>e.jsxs("div",{className:`${s.BG_PRIMARY} rounded-lg p-4 border ${s.BORDER} ${t.is_internal?"border-l-4 border-l-yellow-500":""}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`font-semibold ${s.TEXT_PRIMARY}`,children:t.commenter_name}),e.jsx("span",{className:`text-xs px-2 py-1 rounded ${t.commenter_type==="user"?"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-100":"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-100"}`,children:t.commenter_type==="user"?"Staff":"Tamu"}),t.is_internal&&e.jsx("span",{className:"text-xs px-2 py-1 rounded bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-100",children:"Internal"})]}),e.jsx("span",{className:`text-sm ${s.TEXT_SECONDARY}`,children:new Date(t.created_at||"").toLocaleString("id-ID")})]}),e.jsx("p",{className:`${s.TEXT_PRIMARY} whitespace-pre-wrap`,children:t.comment_text})]},t.id))}),a.status!=="solved"&&e.jsxs("form",{onSubmit:U,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:`block ${s.TEXT_PRIMARY} mb-2 font-medium`,children:"Tambahkan Komentar"}),e.jsx("textarea",{value:g,onChange:t=>y(t.target.value),placeholder:"Tulis komentar...",required:!0,rows:4,className:`w-full px-4 py-2 rounded-lg ${s.BG_PRIMARY} ${s.TEXT_PRIMARY} border ${s.BORDER} focus:outline-none focus:ring-2 focus:ring-accent-blue resize-none`})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:N,onChange:t=>_(t.target.checked),className:"rounded"}),e.jsx("span",{className:`text-sm ${s.TEXT_SECONDARY}`,children:"Komentar Internal (hanya untuk staff)"})]}),e.jsx("button",{type:"submit",disabled:v,className:`ml-auto px-6 py-2 rounded-lg ${s.BUTTON_PRIMARY} ${s.TEXT_ON_ACCENT} hover:opacity-90 transition-opacity disabled:opacity-50`,children:v?"Mengirim...":"Kirim"})]})]})]})]}),e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:`${s.BG_SECONDARY} rounded-lg p-6 border ${s.BORDER}`,children:[e.jsx("h3",{className:`text-xl font-bold ${s.TEXT_PRIMARY} mb-4`,children:"Penugasan"}),(l==null?void 0:l.role)==="admin"&&a.status!=="solved"&&e.jsxs("form",{onSubmit:F,className:"space-y-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:`block ${s.TEXT_PRIMARY} mb-2 text-sm font-medium`,children:"Tugaskan ke"}),e.jsxs("select",{value:x,onChange:t=>k(t.target.value),required:!0,className:`w-full px-4 py-2 rounded-lg ${s.BG_PRIMARY} ${s.TEXT_PRIMARY} border ${s.BORDER} focus:outline-none focus:ring-2 focus:ring-accent-blue`,children:[e.jsx("option",{value:"",children:"Pilih user..."}),w.map(t=>e.jsxs("option",{value:t.username,children:[t.name," (",t.username,")"]},t.username))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:`block ${s.TEXT_PRIMARY} mb-2 text-sm font-medium`,children:"Catatan (opsional)"}),e.jsx("textarea",{value:$,onChange:t=>A(t.target.value),placeholder:"Catatan untuk penugasan...",rows:3,className:`w-full px-4 py-2 rounded-lg ${s.BG_PRIMARY} ${s.TEXT_PRIMARY} border ${s.BORDER} focus:outline-none focus:ring-2 focus:ring-accent-blue resize-none`})]}),e.jsx("button",{type:"submit",disabled:I,className:`w-full px-4 py-2 rounded-lg ${s.BUTTON_PRIMARY} ${s.TEXT_ON_ACCENT} hover:opacity-90 transition-opacity disabled:opacity-50`,children:I?"Menugaskan...":"Tugaskan"})]}),e.jsxs("div",{children:[e.jsx("h4",{className:`font-semibold ${s.TEXT_PRIMARY} mb-2`,children:"Riwayat Penugasan"}),m.length===0?e.jsx("p",{className:`${s.TEXT_SECONDARY} text-sm`,children:"Belum ada riwayat penugasan"}):e.jsx("div",{className:"space-y-2",children:m.map(t=>e.jsxs("div",{className:`${s.BG_PRIMARY} rounded p-3 text-sm border ${s.BORDER}`,children:[e.jsxs("div",{className:`font-semibold ${s.TEXT_PRIMARY}`,children:[t.assigned_from?`${t.assigned_from} â†’`:""," ",t.assigned_to]}),e.jsxs("div",{className:`text-xs ${s.TEXT_SECONDARY}`,children:["oleh ",t.assigned_by]}),t.notes&&e.jsx("div",{className:`text-xs ${s.TEXT_SECONDARY} mt-1`,children:t.notes}),e.jsx("div",{className:`text-xs ${s.TEXT_SECONDARY} mt-1`,children:new Date(t.created_at||"").toLocaleString("id-ID")})]},t.id))})]})]})})]})]})};export{xe as default};
