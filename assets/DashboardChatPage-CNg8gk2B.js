import{j as e}from"./particles-CSzCUO-v.js";import{b as n}from"./vendor-BFu755QE.js";import{c as J,D as Q}from"./index-BzGNHlk_.js";import{a as V}from"./apiClient-0gU9eKXL.js";import{a as W,b as ne,c as le,e as ie,f as de,u as oe,r as ce,h as ue,i as me,j as xe,k as he,l as fe}from"./chatService-BORdFYKP.js";const be=({isOpen:i,onClose:a,onGroupCreated:d})=>{const{theme:y}=J(),r=Q[y],p=V(),[N,$]=n.useState("create"),[A,m]=n.useState([]),[u,x]=n.useState(null),[T,U]=n.useState([]),[C,o]=n.useState(!1),[F,l]=n.useState(null),[j,w]=n.useState(""),[k,B]=n.useState(""),[f,L]=n.useState(""),[D,R]=n.useState("member");n.useEffect(()=>{i&&N==="manage"&&M()},[i,N]),n.useEffect(()=>{u&&_()},[u]);const M=async()=>{o(!0),l(null);try{const h=(await W()).filter(S=>S.user_role==="admin");m(h)}catch(s){l(s.message||"Failed to load groups")}finally{o(!1)}},_=async()=>{if(u){o(!0),l(null);try{const s=await ne(u);U(s)}catch(s){l(s.message||"Failed to load members")}finally{o(!1)}}},G=async()=>{if(!j.trim()){l("Group name is required");return}o(!0),l(null);try{await le({name:j.trim(),description:k.trim()||void 0}),w(""),B(""),d&&d(),$("manage"),await M()}catch(s){l(s.message||"Failed to create group")}finally{o(!1)}},E=async()=>{if(!u||!f.trim()){l("Username is required");return}o(!0),l(null);try{await de(u,{user_username:f.trim(),role:D}),L(""),R("member"),await _()}catch(s){l(s.message||"Failed to add member")}finally{o(!1)}},O=async s=>{if(u&&confirm(`Are you sure you want to remove ${s}?`)){o(!0),l(null);try{await ce(u,s),await _()}catch(h){l(h.message||"Failed to remove member")}finally{o(!1)}}},I=async(s,h)=>{if(u){o(!0),l(null);try{await oe(u,s,h),await _()}catch(S){l(S.message||"Failed to update role")}finally{o(!1)}}},b=async()=>{if(!u)return;const s=A.find(h=>h.id===u);if(confirm(`Are you sure you want to delete the group "${s==null?void 0:s.name}"? This action cannot be undone.`)){o(!0),l(null);try{await ie(u),x(null),U([]),await M()}catch(h){l(h.message||"Failed to delete group")}finally{o(!1)}}};return i?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm p-4",children:e.jsxs("div",{className:`${r.surface} rounded-lg shadow-2xl max-w-4xl w-full max-h-[80vh] flex flex-col`,children:[e.jsxs("div",{className:`p-4 ${r.sidebar.border} flex justify-between items-center`,children:[e.jsx("h2",{className:"text-xl font-bold",children:"ðŸ‘¥ Group Management"}),e.jsx("button",{onClick:a,className:"hover:text-red-500 text-2xl font-bold",children:"Ã—"})]}),e.jsxs("div",{className:`flex ${r.sidebar.border}`,children:[e.jsx("button",{className:`flex-1 py-3 px-4 font-medium transition-colors ${N==="create"?`${r.button.primary} text-white`:`${r.sidebar.textMuted} hover:${r.sidebar.hover}`}`,onClick:()=>$("create"),children:"Create Group"}),e.jsx("button",{className:`flex-1 py-3 px-4 font-medium transition-colors ${N==="manage"?`${r.button.primary} text-white`:`${r.sidebar.textMuted} hover:${r.sidebar.hover}`}`,onClick:()=>$("manage"),children:"Manage Groups"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4",children:[F&&e.jsx("div",{className:`${r.badges.danger} p-3 rounded mb-4`,children:F}),N==="create"?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block mb-2 font-medium",children:"Group Name *"}),e.jsx("input",{type:"text",value:j,onChange:s=>w(s.target.value),placeholder:"Enter group name",className:`w-full px-4 py-2 rounded ${r.input} focus:ring-2 focus:ring-blue-500 focus:outline-none`})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-2 font-medium",children:"Description (Optional)"}),e.jsx("textarea",{value:k,onChange:s=>B(s.target.value),placeholder:"Enter group description",rows:3,className:`w-full px-4 py-2 rounded ${r.input} focus:ring-2 focus:ring-blue-500 focus:outline-none`})]}),e.jsx("button",{onClick:G,disabled:!j.trim()||C,className:`w-full py-2 px-4 rounded ${r.button.primary} text-white hover:opacity-90 transition-opacity disabled:opacity-50`,children:C?"Creating...":"Create Group"})]}):e.jsx("div",{className:"space-y-4",children:A.length===0?e.jsx("div",{className:`text-center py-8 ${r.sidebar.textMuted}`,children:"You don't manage any groups yet. Create one to get started!"}):e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold mb-3",children:"Your Groups"}),e.jsx("div",{className:"space-y-2",children:A.map(s=>e.jsxs("div",{className:`p-3 rounded cursor-pointer transition-colors ${u===s.id?r.sidebar.active:`${r.surface} hover:${r.sidebar.hover}`}`,onClick:()=>x(s.id),children:[e.jsx("div",{className:"font-medium",children:s.name}),e.jsxs("div",{className:`text-sm ${r.sidebar.textMuted}`,children:[s.member_count," members"]})]},s.id))})]}),e.jsx("div",{children:u?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsx("h3",{className:"font-bold",children:"Members"}),e.jsx("button",{onClick:b,className:"text-sm text-red-500 hover:text-red-700",children:"Delete Group"})]}),e.jsxs("div",{className:`p-3 rounded ${r.surface} mb-3`,children:[e.jsx("div",{className:"text-sm font-medium mb-2",children:"Add Member"}),e.jsxs("div",{className:"flex gap-2 mb-2",children:[e.jsx("input",{type:"text",value:f,onChange:s=>L(s.target.value),placeholder:"Username",className:`flex-1 px-3 py-1 text-sm rounded ${r.input} focus:ring-2 focus:ring-blue-500 focus:outline-none`}),e.jsxs("select",{value:D,onChange:s=>R(s.target.value),className:`px-3 py-1 text-sm rounded ${r.input} focus:ring-2 focus:ring-blue-500 focus:outline-none`,children:[e.jsx("option",{value:"member",children:"Member"}),e.jsx("option",{value:"admin",children:"Admin"})]})]}),e.jsx("button",{onClick:E,disabled:!f.trim()||C,className:`w-full py-1 px-3 text-sm rounded ${r.button.primary} text-white hover:opacity-90 transition-opacity disabled:opacity-50`,children:"Add"})]}),e.jsx("div",{className:"space-y-2",children:T.map(s=>e.jsxs("div",{className:`p-3 rounded ${r.surface} flex justify-between items-center`,children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.name}),e.jsxs("div",{className:`text-sm ${r.sidebar.textMuted}`,children:["@",s.user_username]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("select",{value:s.role,onChange:h=>I(s.user_username,h.target.value),disabled:s.user_username===(p==null?void 0:p.username),className:`px-2 py-1 text-sm rounded ${r.input} focus:ring-2 focus:ring-blue-500 focus:outline-none disabled:opacity-50`,children:[e.jsx("option",{value:"member",children:"Member"}),e.jsx("option",{value:"admin",children:"Admin"})]}),s.user_username!==(p==null?void 0:p.username)&&e.jsx("button",{onClick:()=>O(s.user_username),className:"text-red-500 hover:text-red-700 text-sm",children:"Remove"})]})]},s.user_username))})]}):e.jsx("div",{className:`text-center py-8 ${r.sidebar.textMuted}`,children:"Select a group to manage members"})})]})})]})]})}):null},Ne=()=>{var Y;const{theme:i}=J(),a=Q[i],d=V(),[y,r]=n.useState("direct"),[p,N]=n.useState([]),[$,A]=n.useState([]),[m,u]=n.useState(null),[x,T]=n.useState(null),[U,C]=n.useState([]),[o,F]=n.useState(""),[l,j]=n.useState(null),[w,k]=n.useState(!1),[B,f]=n.useState(null),[L,D]=n.useState(!1),[R,M]=n.useState(!1),[_,G]=n.useState(""),[E,O]=n.useState(!1),[I,b]=n.useState(null),[s,h]=n.useState(!0);n.useEffect(()=>{S()},[y]),n.useEffect(()=>{m&&K()},[m,x]);const S=async()=>{k(!0),f(null);try{if(y==="direct"){const t=await ue();N(t)}else{const t=await W();A(t)}}catch(t){f(t.message||"Failed to load chats")}finally{k(!1)}},K=async t=>{const c=(t==null?void 0:t.id)??m,g=(t==null?void 0:t.type)??x;if(!(!c||!g)){k(!0),f(null);try{let v;g==="conversation"?v=await me(c):v=await xe(c),C(v)}catch(v){f(v.message||"Failed to load messages")}finally{k(!1)}}},P=async()=>{if(!(!o.trim()||!m||!x)){f(null);try{const t={content:o.trim()};x==="conversation"?t.conversation_id=m:t.group_id=m,l&&(t.reply_to_id=l.id),await he(t),F(""),j(null),await K()}catch(t){f(t.message||"Failed to send message")}}},z=(t,c)=>{u(t),T(c),C([]),j(null),h(!1)},X=t=>{j(t)},Z=()=>{j(null)},q=()=>{if(!m||!x)return"";if(x==="conversation"){const t=p.find(c=>c.id===m);return(t==null?void 0:t.other_name)||(t==null?void 0:t.other_username)||""}else{const t=$.find(c=>c.id===m);return(t==null?void 0:t.name)||""}},ee=()=>{G(""),b(null),M(!0)},H=()=>{E||(M(!1),G(""),b(null))},te=async()=>{if(!d){b("Pengguna tidak ditemukan. Silakan login ulang.");return}const t=_.trim();if(!t){b("Username wajib diisi");return}if(t.toLowerCase()===d.username.toLowerCase()){b("Tidak dapat memulai chat dengan diri sendiri");return}O(!0),b(null);try{const c=await fe(t),g=c.user1_username===d.username?c.user2_username:c.user1_username,v={...c,other_username:g,other_name:c.other_name??g};r("direct"),N(se=>{const ae=se.filter(re=>re.id!==v.id);return[v,...ae]}),u(v.id),T("conversation"),C([]),await K({id:v.id,type:"conversation"}),M(!1),G("")}catch(c){const g=(c==null?void 0:c.message)||"Gagal memulai percakapan";g.includes("Cannot create conversation with yourself")?b("Tidak dapat memulai chat dengan diri sendiri"):g.includes("not found")||g.includes("tidak ditemukan")?b("Username tidak ditemukan"):b(g)}finally{O(!1)}};return e.jsxs("div",{className:`flex-1 min-h-0 h-full flex flex-col md:flex-row ${a.surface} rounded-lg shadow-lg`,children:[e.jsxs("div",{className:`${s?"flex":"hidden"} md:flex w-full md:w-80 ${a.sidebar.bg} ${a.sidebar.border} flex-col min-h-0`,children:[e.jsxs("div",{className:`flex ${a.sidebar.border}`,children:[e.jsx("button",{className:`flex-1 py-3 px-4 font-medium transition-colors ${y==="direct"?`${i==="dark"?"bg-[#111b21] text-[#9333EA]":"bg-white text-[#9333EA]"} border-b-2 border-[#9333EA]`:`${a.sidebar.textMuted} hover:${a.sidebar.hover}`}`,onClick:()=>r("direct"),children:"ðŸ’¬ Chat Langsung"}),e.jsx("button",{className:`flex-1 py-3 px-4 font-medium transition-colors ${y==="group"?`${i==="dark"?"bg-[#111b21] text-[#9333EA]":"bg-white text-[#9333EA]"} border-b-2 border-[#9333EA]`:`${a.sidebar.textMuted} hover:${a.sidebar.hover}`}`,onClick:()=>r("group"),children:"ðŸ‘¥ Grup"})]}),e.jsxs("div",{className:"p-3 space-y-2",children:[e.jsx("button",{onClick:S,disabled:w,className:"w-full py-2 px-4 rounded-lg bg-[#2563EB] text-white hover:bg-[#1D4ED8] transition-colors disabled:opacity-50",children:w?"âŸ³ Memuat ulang...":"ðŸ”„ Muat Ulang"}),e.jsx("button",{onClick:ee,className:`w-full py-2 px-4 rounded-lg ${i==="dark"?"bg-[#2a3942] text-white hover:bg-[#374850]":"bg-white text-gray-700 hover:bg-gray-100"} transition-colors`,children:"âž• Chat Baru"}),y==="group"&&e.jsx("button",{onClick:()=>D(!0),className:`w-full py-2 px-4 rounded-lg ${i==="dark"?"bg-[#2a3942] text-white hover:bg-[#374850]":"bg-white text-gray-700 hover:bg-gray-100"} transition-colors`,children:"âš™ï¸ Kelola Grup"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:y==="direct"?e.jsx("div",{children:p.length===0?e.jsx("div",{className:`p-4 text-center ${a.sidebar.textMuted}`,children:"Belum ada percakapan"}):p.map(t=>e.jsxs("div",{className:`p-3 cursor-pointer transition-colors ${a.sidebar.border} flex items-center gap-3 ${m===t.id&&x==="conversation"?a.sidebar.active:`hover:${a.sidebar.hover}`}`,onClick:()=>z(t.id,"conversation"),children:[e.jsx("div",{className:`w-12 h-12 rounded-full flex items-center justify-center text-white font-bold text-lg flex-shrink-0 ${i==="dark"?"bg-[#2a3942]":"bg-gray-400"}`,children:(t.other_name||t.other_username).charAt(0).toUpperCase()}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium truncate",children:t.other_name||t.other_username}),t.last_message&&e.jsx("div",{className:`text-sm ${a.sidebar.textMuted} truncate`,children:t.last_message})]})]},t.id))}):e.jsx("div",{children:$.length===0?e.jsx("div",{className:`p-4 text-center ${a.sidebar.textMuted}`,children:"Belum ada grup"}):$.map(t=>e.jsxs("div",{className:`p-3 cursor-pointer transition-colors ${a.sidebar.border} flex items-center gap-3 ${m===t.id&&x==="group"?a.sidebar.active:`hover:${a.sidebar.hover}`}`,onClick:()=>z(t.id,"group"),children:[e.jsx("div",{className:`w-12 h-12 rounded-full flex items-center justify-center text-white font-bold text-lg flex-shrink-0 ${i==="dark"?"bg-[#2a3942]":"bg-gray-400"}`,children:"ðŸ‘¥"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium truncate",children:t.name}),e.jsxs("div",{className:`text-sm ${a.sidebar.textMuted}`,children:[t.member_count," anggota"]}),t.last_message&&e.jsx("div",{className:`text-sm ${a.sidebar.textMuted} truncate`,children:t.last_message})]})]},t.id))})})]}),e.jsx("div",{className:`${!s||!m?"flex":"hidden"} md:flex flex-1 min-h-0 flex-col overflow-hidden`,children:m&&x?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:`flex-shrink-0 p-3 ${a.header.border} flex justify-between items-center ${a.header.bg} backdrop-blur-md`,children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[e.jsx("button",{onClick:()=>h(!0),className:"md:hidden text-xl",children:"â†"}),e.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center text-white font-bold flex-shrink-0 ${i==="dark"?"bg-[#2a3942]":"bg-gray-400"}`,children:x==="group"?"ðŸ‘¥":q().charAt(0).toUpperCase()}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h2",{className:"text-base font-medium truncate",children:q()}),e.jsx("p",{className:`text-xs ${i==="dark"?"text-gray-400":"text-gray-600"}`,children:x==="group"?"Grup chat":"Online"})]})]}),e.jsx("button",{onClick:()=>K(),disabled:w,className:`p-2 rounded-full ${i==="dark"?"hover:bg-[#2a3942]":"hover:bg-gray-200"} transition-colors disabled:opacity-50`,title:"Muat ulang pesan",children:w?"âŸ³":"ðŸ”„"})]}),e.jsxs("div",{className:`flex-1 h-[calc(100vh-280px)] overflow-y-auto p-4 space-y-2 ${a.contentBg}`,children:[B&&e.jsx("div",{className:"bg-red-500 text-white p-3 rounded",children:B}),U.map(t=>e.jsx("div",{className:`flex ${t.sender_username===(d==null?void 0:d.username)?"justify-end":"justify-start"} mb-1`,children:e.jsxs("div",{className:"flex flex-col max-w-[70%] md:max-w-md",children:[t.sender_username!==(d==null?void 0:d.username)&&x==="group"&&e.jsx("div",{className:`text-xs font-medium mb-1 ml-3 ${i==="dark"?"text-gray-400":"text-gray-600"}`,children:t.sender_name}),e.jsxs("div",{className:`relative p-2 px-3 shadow-sm ${t.sender_username===(d==null?void 0:d.username)?"bg-[#1D4ED8] text-white rounded-tl-lg rounded-tr-lg rounded-bl-lg":i==="dark"?"bg-[#1f2c34] text-gray-100 rounded-tl-lg rounded-tr-lg rounded-br-lg":"bg-white text-gray-900 rounded-tl-lg rounded-tr-lg rounded-br-lg"}`,children:[t.reply_to_id&&t.reply_content&&e.jsxs("div",{className:`text-xs p-2 mb-2 rounded border-l-4 ${t.sender_username===(d==null?void 0:d.username)?"bg-[#1E40AF] border-[#3B82F6]":i==="dark"?"bg-[#182229] border-[#3B82F6]":"bg-gray-100 border-[#3B82F6]"}`,children:[e.jsx("div",{className:"font-medium text-[#60A5FA]",children:t.reply_sender_name}),e.jsx("div",{className:"truncate opacity-80",children:t.reply_content})]}),e.jsx("div",{className:"break-words",children:t.content}),e.jsx("div",{className:"flex items-center justify-end gap-1 mt-1",children:e.jsx("span",{className:"text-[10px] opacity-60",children:new Date(t.created_at).toLocaleTimeString("id-ID",{hour:"2-digit",minute:"2-digit"})})})]}),t.sender_username!==(d==null?void 0:d.username)&&e.jsx("button",{onClick:()=>X(t),className:`text-[10px] mt-1 ml-3 hover:underline ${i==="dark"?"text-gray-400":"text-gray-600"}`,children:"Balas"})]})},t.id))]}),e.jsxs("div",{className:`flex-shrink-0 p-3 ${a.header.border} ${i==="dark"?"bg-[#1f2c34]":"bg-[#f0f2f5]"}`,children:[l&&e.jsxs("div",{className:`mb-2 p-2 rounded-lg ${i==="dark"?"bg-[#2a3942]":"bg-white"} flex justify-between items-start border-l-4 border-[#3B82F6]`,children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"text-xs font-medium text-[#60A5FA]",children:["Membalas ",l.sender_name]}),e.jsx("div",{className:"text-sm truncate opacity-80",children:l.content})]}),e.jsx("button",{onClick:Z,className:"ml-2 text-gray-400 hover:text-red-500",children:"âœ•"})]}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("input",{type:"text",value:o,onChange:t=>F(t.target.value),onKeyPress:t=>{t.key==="Enter"&&!t.shiftKey&&(t.preventDefault(),P())},placeholder:"Ketik pesan...",className:`flex-1 px-4 py-3 rounded-full ${i==="dark"?"bg-[#2a3942] text-white":"bg-white text-gray-900"} focus:ring-2 focus:ring-[#3B82F6] focus:outline-none`}),e.jsx("button",{onClick:P,disabled:!o.trim()||w,className:"p-3 rounded-full bg-[#2563EB] text-white hover:bg-[#1D4ED8] transition-colors disabled:opacity-50 disabled:cursor-not-allowed",title:"Kirim",children:e.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"})})})]})]})]}):e.jsx("div",{className:`flex-1 flex items-center justify-center ${a.contentBg}`,children:e.jsxs("div",{className:`text-center ${a.sidebar.textMuted}`,children:[e.jsx("div",{className:"text-6xl mb-4",children:"ðŸ’¬"}),e.jsx("div",{className:"text-lg font-medium mb-2",children:"Chattingan"}),e.jsx("div",{className:"text-sm opacity-70",children:"Pilih percakapan untuk mulai mengirim pesan"})]})})}),e.jsx(be,{isOpen:L,onClose:()=>D(!1),onGroupCreated:()=>{S()}}),R&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm p-4",children:e.jsxs("div",{className:`${a.surface} rounded-lg shadow-2xl max-w-md w-full`,children:[e.jsxs("div",{className:`p-4 ${a.sidebar.border} flex justify-between items-center`,children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Mulai Percakapan Baru"}),e.jsx("button",{onClick:H,className:"text-2xl leading-none hover:text-red-500","aria-label":"Tutup",children:"Ã—"})]}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Username Tujuan"}),e.jsx("input",{type:"text",value:_,onChange:t=>G(t.target.value),placeholder:"Masukkan username pengguna",className:`w-full px-4 py-2 rounded ${a.input} focus:ring-2 focus:ring-blue-500 focus:outline-none`})]}),I&&e.jsx("div",{className:"text-sm text-red-500",children:I}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{onClick:H,disabled:E,className:`px-4 py-2 rounded ${((Y=a.buttons)==null?void 0:Y.ghost)??"border border-gray-300 text-gray-600 hover:border-accent-blue hover:text-accent-blue"} disabled:opacity-50`,children:"Batal"}),e.jsx("button",{onClick:te,disabled:E,className:`px-4 py-2 rounded ${a.button.primary} text-white hover:opacity-90 transition-opacity disabled:opacity-50`,children:E?"Memulai...":"Mulai Chat"})]})]})]})})]})};export{Ne as default};
